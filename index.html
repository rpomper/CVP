<!DOCTYPE html>
<html>

<head>
  <title>Basic LWL</title>
  <meta charset="utf-8"/>
  <script src="jspsych-6.1.0/jspsych.js"> </script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-free-sort.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <!-- <script src="jspsych-6.1.0/papaparse.min.js"></script>  -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.2/papaparse.min.js"></script> -->
  <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response-flexiblelocations.js"></script>
  <!--<script src="jspsych-6.1.0/google-spreadsheet.js"></script> -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.2.0/papaparse.min.js"></script>
  <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css",type="text/css"> </link>
  <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
  <style>
  div.absolute {
    position: absolute;
    left: 10px;
    right:0px;
    top:10px;
    border: 3px solid #73AD21;
  }
  </style>
</head>
<body>
  <div id="colors-lwl"></div>
</body>

<script>


// $('body,html').addClass('stop-scrolling');
//$('body').bind('touchmove', function(e){e.preventDefault()})


//Enter subject id
//var subject_id = prompt("Enter subject id", "test");
//var trial_order = prompt("Order (1-2)","1");
var subject_id = jsPsych.data.getURLVariable('sub')
var trial_order = jsPsych.data.getURLVariable('order')

// var input = prompt("Enter input type (touch or click)","touch");

// jsPsych.data.addProperties({
// 	subject: subject_id,
// 	order: trial_order
// });

// choose csv file
if (trial_order == "1") {
  var publicSpreadsheetUrl = 'https://raw.githubusercontent.com/rpomper/PreFam/master/orders/PreFam-Order-1.csv';
} else if (trial_order == "2") {
  var publicSpreadsheetUrl = 'https://raw.githubusercontent.com/rpomper/PreFam/master/orders/PreFam-Order-2.csv';
}


Papa.parse(publicSpreadsheetUrl, {
	          download: true,
	          header: true,
            dynamicTyping: true,
	          complete: function(results) {
	            var data = results.data
	            console.log(data)
              startExperiment(data);
	          }
	        })

// function showInfo(data, tabletop) {
//   alert('Successfully processed!')
//   console.log(data);
// }

// window.addEventListener('DOMContentLoaded', init)

document.body.style.backgroundColor = "black";
// document.body.style.backgroundImage = "url('stimuli/images/black-background.jpg')";
document.body.style.backgroundSize = "100%";
document.body.style.backgroundPosition = "top";
document.body.style.backgroundRepeat = "no-repeat";


var timeline = []

function createTrials(data, tabletop) {

  // data = data['Order_'+trial_order]['elements']
  // console.log(data);

  //stim = tabletop.sheets("stimulus_sheet").toArray()

  // var welcome = {
  //   type: "html-keyboard-response",
  //   stimulus: "Welcome to the experiment. Press any key to begin."
  // };

  var welcome = {
    type: "fullscreen",
    // fullscreen_mode: false,
    message: "<br><br><br><p>Subject: "+subject_id.toString()+"</p><p>Order: "+trial_order.toString()+"</p><br>",
    button_label: "Click Here",
    delay_after: 250
  }

  // timeline.push(welcome);

  // var audio_test = {
  //   type: "audio-keyboard-response",
  //   stimulus:"stimuli/sounds/audio_check.wav",
  //   choices:['space'],
  //   prompt: "<br><br><br><br><br><br><br><br><p style='font-size:30px;'> Please adjust the volume on your computer <br> so that your child can comfortably hear the sounds being played. <br> Sounds should be as loud as a person's voice in the room. <br><br><br> Please tell the experimenter when you are ready.</br> </p>"
  // }
  //
  // timeline.push(audio_test);

  var wait_to_start = {
    type: "html-keyboard-response",
    // fullscreen_mode: false,
    choices:['space'],
    stimulus: "<br><br><br><br><br><br><br><br><p style='font-size:30px;'> When you are ready, press the space bar to begin.</br> </p>"
  }

  timeline.push(wait_to_start);

  var expLength = data.length;
  var audioExt="stimuli/sounds/"
  var imageStart='<img src= "stimuli/images/'
  var imageStop= '.jpg"  title = "" width="300" height="300">'
  // var numStop= '.jpg"  title = "" width="100" height="100">'


  var num_pad = {
    type: 'audio-button-response-flexiblelocations',
    trial_duration: 2000,
    response_ends_trial: true,
    margin_top: ['0px','0px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','250px'],
    margin_right: ['250px','0px'],
    set_background: 'numpad-empty',
    // stimulus: audioExt+data[i]['stimulus']+".wav",
    choices: [imageStart+'numpad-keys'+imageStop],
    // choices: [imageStart+'1'+numStop, imageStart+'2'+numStop,imageStart+'3'+numStop,
    // imageStart+'4'+numStop,imageStart+'5'+numStop,imageStart+'6'+numStop,
    // imageStart+'7'+numStop,imageStart+'8'+numStop,imageStart+'9'+numStop],
  }

  timeline.push(num_pad)

  // lwl_stimuli = []

  var sorting_stimuli = ['stimuli/images/spaceship-1.jpg','stimuli/images/spaceship-2.jpg','stimuli/images/spaceship-3.jpg']
  // for (var i = 1; i <= 12; i++) {
  //   sorting_stimuli.push("img/cell_img_" + i + ".jpg");
  // }

  var sort_trial = {
    type: 'free-sort',
    stimuli: sorting_stimuli,
    stim_height: 150,
    stim_width: 150,
    sort_area_height: 500,
    sort_area_width: 800,
    set_background:'launch-pad-background',
    prompt: "<p>Help Bear build their space ship. Click and drag the pieces of the ship to the launch pad.</p>"
  };

  timeline.push(sort_trial)

  for (var i = 0; i < expLength; i++) {
    // lwl_stimuli.push(
    // {stimulus: audioExt+data[i]['stimulus']+".wav",
    // choices:[imageStart+data[i]['left_image']+imageStop, imageStart+data[i]['right_image']+imageStop],
    // set_background:data[i]['background'],
    // data:{condition:data[i]['condition'],target_side:data[i]['target_side'],correct_response:data[i]['correct_response'],background:data[i]['background']},
    // iti_tr_num: "Trial"
    // })

    var show_trial_num = {
      type:'html-keyboard-response',
      stimulus: "<p style='font-size:90px;'>"+i.toString()+"</p>",
      choices: jsPsych.NO_KEYS,
      trial_duration: 500
    }

    timeline.push(show_trial_num)


    var show_planets = {
      type: 'audio-button-response-flexiblelocations',
      trial_duration: 2000,
      response_ends_trial: false,
      margin_top: ['0px','0px'],
      margin_bottom: ['0px','0px'],
      margin_left: ['0px','250px'],
      margin_right: ['250px','0px'],
      // stimulus: audioExt+data[i]['stimulus']+".wav",
      choices: [imageStart+data[i]['left_planet']+imageStop, imageStart+data[i]['right_planet']+imageStop],
    }

    timeline.push(show_planets)


    var lwl_trial = {
      type: 'audio-button-response-flexiblelocations',
      trial_duration: 4702,
      // response_ends_trial: false,
      response_ends_trial: true,
      margin_top: ['0px','0px'],
      margin_bottom: ['0px','0px'],
      margin_left: ['0px','250px'],
      margin_right: ['250px','0px'],
      // stimulus: audioExt+data[i]['stimulus']+".wav",
      choices: [imageStart+data[i]['left_image']+imageStop, imageStart+data[i]['right_image']+imageStop],
      set_background:data[i]['background'],
      data:{condition:data[i]['condition'],target_side:data[i]['target_side'],correct_response:data[i]['correct_response'],background:data[i]['background']},
      post_trial_gap: 500,
      on_finish: function(data) {
        data.correct = data.button_pressed == data.correct_response;
      }
    }

    timeline.push(lwl_trial)

  }

  // var lwl_trials = {
  //   type: 'audio-button-response-flexiblelocations',
  //   // trial_duration: 4702,
  //   // response_ends_trial: false,
  //   response_ends_trial: true,
  //   margin_top: ['0px','0px'],
  //   margin_bottom: ['0px','0px'],
  //   // margin_left: ['0px','89px'],
  //   // margin_right: ['89px','0px'],
  //   margin_left: ['0px','250px'],
  //   margin_right: ['250px','0px'],
  //   // set_background:data.background,
  //   timeline: lwl_stimuli,
  //   data: jsPsych.timelineVariable('data'),
  //   on_finish: function(data) {
  //     data.correct = data.button_pressed == data.correct_response;
  //   }
  // }
  //
  // timeline.push(lwl_trials);

  var fullscreen_exit = {
    type: 'fullscreen',
    fullscreen_mode: false
  }
  timeline.push(fullscreen_exit)
};


var imageExt = 'stimuli/images/'

var images = [imageExt+'B1.jpg',
imageExt+'C1.jpg',
imageExt+'D1.jpg',
imageExt+'H1.jpg',
imageExt+'J1.jpg',
imageExt+'A1.jpg',
imageExt+'E1.jpg',
imageExt+'I1.jpg',
imageExt+'K1.jpg',
imageExt+'L1.jpg',
imageExt+'jupiter.jpg',
imageExt+'mars.jpg',
imageExt+'mercury.jpg',
imageExt+'neptune.jpg',
imageExt+'saturn.jpg',
imageExt+'venus.jpg',
imageExt+'black.jpg',
imageExt+'black-background.jpg',
imageExt+'launch-pad-background.jpg',
imageExt+'spaceship-1.jpg',
imageExt+'spaceship-2.jpg',
imageExt+'spaceship-3.jpg',
imageExt+'numpad-empty',
imageExt+'numpad-keys']


function startExperiment(data, tabletop) {
	// createTrials(data,tabletop);
  createTrials(data);
jsPsych.init({
  timeline: timeline,
  // preload_audio:audio,
  preload_images:images,
  default_iti:0,
  on_finish: function() {
    //jsPsych.data.displayData();
    // save_data('yumME','V1',subject_id, jsPsych.data.dataAsCSV());
  }
});
};

// function save_data(experiment, version,identifier, data){
// 	$.ajax({
// 		type: 'post',
// 		cache: false,
// 		url: 'https://data.infantlearning.waisman.wisc.edu/infantdb/datastore/save/',
// 		data: {
// 			experiment: experiment,
// 	version: version,
// 			identifier: identifier,
// 			data: data
// 		}
// 	})
// };


</script>

</html>
